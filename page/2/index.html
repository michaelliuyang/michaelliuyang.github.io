<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3PXW8DRLC1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3PXW8DRLC1');
</script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"skywalkerai.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
<meta property="og:type" content="website">
<meta property="og:title" content="天行者YANG - BLOG">
<meta property="og:url" content="https://skywalkerai.com/page/2/index.html">
<meta property="og:site_name" content="天行者YANG - BLOG">
<meta property="og:description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="天行者YANG">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://skywalkerai.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>天行者YANG - BLOG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">天行者YANG - BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>全部文章</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/12/02/%E7%A0%94%E5%8F%91%E5%9B%A2%E9%98%9F%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E4%B8%8E%E5%88%86%E4%BA%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/02/%E7%A0%94%E5%8F%91%E5%9B%A2%E9%98%9F%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E4%B8%8E%E5%88%86%E4%BA%AB/" class="post-title-link" itemprop="url">研发团队技术学习与分享</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-02 19:45:47" itemprop="dateCreated datePublished" datetime="2020-12-02T19:45:47+08:00">2020-12-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AE%A1%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">技术管理</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><hr>
<p>首先，我们需要明确为什么要做这件事情。这件事情能给大家带来什么，预期结果又是什么，这里的“大家”主要有3个主体：公司、团队、个人，每个主体对于技术学习与分享这件事件，都有不同的预期结果，下面总结了几点目的：</p>
<ul>
<li>学习新技术，提升自我，形成技术知识体系</li>
<li>提升专业知识领域的经验</li>
<li>提升沟通和表达能力</li>
<li>学习和分析内容，可以帮助产品技术框架、性能、工具的推进</li>
<li>技术资料的沉淀，形成公司技术价值</li>
</ul>
<h1 id="如何开始"><a href="#如何开始" class="headerlink" title="如何开始"></a>如何开始</h1><hr>
<p>了解了目的，我们需要想想如何做，才能达成目的。成人的学习、培训是比较难顺利推进，繁重的开发任务和人的惰性，Leader和管理层是否真正关注和帮助大家，这些都是历来公司内部推进技术学习与分享的各种困难，最后很多公司和团队都是不了了之。那么我们怎么做才能避免一些坑呢：</p>
<ul>
<li>管理层统一思想，技术学习和分享是长期工作，其效果体现需要长期来看和评估</li>
<li>内容的质量，内容不能过浅</li>
<li>明确的分享周期和分享团队，明确分享人和听众的责任</li>
<li>选择内容不能随意，需要针对“听众”的情况，选择感兴趣的内容</li>
</ul>
<h1 id="如何做"><a href="#如何做" class="headerlink" title="如何做"></a>如何做</h1><hr>
<h2 id="1-分享成员"><a href="#1-分享成员" class="headerlink" title="1.分享成员"></a>1.分享成员</h2><p>降低责任分母，如果12人团队，责任分母是12，会因为各种原因，某个人觉得不是我一个人的事情，很难主动分享；把分享做成小组，责任分母变小，可能是2或者3，这样小组内推进，比每个人的自驱动力推进来的靠谱。</p>
<p> 我们目前的研发团队组成有3类</p>
<ul>
<li>RD：4人</li>
<li>FE：5人</li>
<li>QA：3人</li>
</ul>
<p>以3个小组为单位，进行技术学习和分享活动，按照顺序轮流执行，小组内，可以一次多人分享，也可以一次一人分享。</p>
<h2 id="2-周期确定"><a href="#2-周期确定" class="headerlink" title="2.周期确定"></a>2.周期确定</h2><p>周期规则必须明确，这样分享人和听众，都有时间去准备。</p>
<h3 id="分享时间规则"><a href="#分享时间规则" class="headerlink" title="分享时间规则"></a>分享时间规则</h3><ul>
<li>频次：每2周1次（几组轮流）</li>
<li>时间：周四晚上19点15分</li>
<li>时长：60分钟内</li>
</ul>
<h3 id="分享人准备"><a href="#分享人准备" class="headerlink" title="分享人准备"></a>分享人准备</h3><ul>
<li>发出大纲：提前1周，即分享前一周的周四前发出</li>
</ul>
<h3 id="听众准备"><a href="#听众准备" class="headerlink" title="听众准备"></a>听众准备</h3><ul>
<li>阅读资料：分享会前1周内，需要把分享资料进行阅读，有分析显示，如果不提前看开会内容，在会议上可能听懂的内容也就20%，为了不浪费自己的生命，也应该分享前去阅读资料</li>
</ul>
<h2 id="3-内容选择"><a href="#3-内容选择" class="headerlink" title="3.内容选择"></a>3.内容选择</h2><p>学习和分享的目的，是为了提高大家的技术水平，扩展大家认知的领域，所以内容选择建议分成2类：技术专题分享、自由主题分享。</p>
<h3 id="如何选择内容"><a href="#如何选择内容" class="headerlink" title="如何选择内容"></a>如何选择内容</h3><p>内容的选择，应该因团队情况和产品技术架构情况而异，每个季度进行一次规划，从团队中了解管理、技术弱点、希望提高的方面、产品下一步的技术和框架的要求，针对规划出来的内容，进行内容的选择（也包含培训课程平台的选择，目前选择的是拉勾教育）。</p>
<h3 id="技术专题分享"><a href="#技术专题分享" class="headerlink" title="技术专题分享"></a>技术专题分享</h3><ul>
<li>有针对性提升团队在某一个技术领域的专业技能</li>
<li>可以快速的，有针对性的使用在现有架构和产品中</li>
<li>往往需要由浅入深，进行循序渐进的分享</li>
</ul>
<h3 id="自由主题分享"><a href="#自由主题分享" class="headerlink" title="自由主题分享"></a>自由主题分享</h3><ul>
<li>拓展认知</li>
<li>内容可以更广，甚至可以邀请相关非技术同学参加</li>
<li>更加要求分享者的表达的逻辑思维，怎么把大家不熟悉的内容，讲明白</li>
</ul>
<p>针对分享类型，可以有针对性的进行技术专题分享和自由主题分享的交替</p>
<h3 id="Reject-Simple"><a href="#Reject-Simple" class="headerlink" title="Reject Simple"></a>Reject Simple</h3><p>想要分享的内容和形式NB，你就得变的NB<br>在内容上，我们拒绝特别简单的技术内容，不要分享安装什么什么环境、什么什么入门之类的</p>
<h2 id="4-团队氛围"><a href="#4-团队氛围" class="headerlink" title="4.团队氛围"></a>4.团队氛围</h2><p>通过技术学习和分享，提升团队的技术氛围，加强大家的了解，提高凝聚力。</p>
<p>分享会提供一些饮料、好吃的，在一个轻松的氛围下，免费学习知识，肯定有更多的人愿意来参与进来，主动性会增强很多。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><hr>
<p>除了学习和分享，也希望大家学会感恩</p>
<p><strong>感谢</strong>公司可以提供平台给大家进行分享的机会；<br><strong>感谢</strong>分享人利用自己时间，准备PPT；<br><strong>感谢</strong>听众认真聆听，踊跃提问；</p>
<p>怀着一颗感恩的心，你会看到更美好的东西，站在别人的角度思考，会让你走向另一个高度！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/11/26/Jenkins%20Pipeline%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94%20%E4%BD%BF%E7%94%A8%E6%89%A9%E5%B1%95%E5%85%B1%E4%BA%AB%E5%BA%93%E6%9E%84%E5%BB%BA%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/26/Jenkins%20Pipeline%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94%20%E4%BD%BF%E7%94%A8%E6%89%A9%E5%B1%95%E5%85%B1%E4%BA%AB%E5%BA%93%E6%9E%84%E5%BB%BA%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">Jenkins Pipeline系列（三）—— 使用扩展共享库构建微信小程序项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-26 17:59:10" itemprop="dateCreated datePublished" datetime="2020-11-26T17:59:10+08:00">2020-11-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Jenkins-Pipeline-微信小程序"><a href="#Jenkins-Pipeline-微信小程序" class="headerlink" title="Jenkins Pipeline 微信小程序"></a>Jenkins Pipeline 微信小程序</h1><h1 id="手动上传不是挺方便的吗"><a href="#手动上传不是挺方便的吗" class="headerlink" title="手动上传不是挺方便的吗"></a>手动上传不是挺方便的吗</h1><p>在初期，小程序开发者1-2人时，通过Win和Mac小程序开发者工具，进行上传确实比较省时省力，但是随着小程序业务代码增多，并行开发任务增多，开发者增多， 在管理各种版本上，都需要牵扯精力，而且上传发布很可能是多个人都会进行的事情了。我们并不能保证每个上传人的环境统一、AppID每次替换都不出错误等等。随着这些问题的发生，自然而然，我们会把频繁做且流程化的事情，做成自动化。</p>
<h1 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h1><h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><ul>
<li>Mac Mini（OR Windows本，这里我使用的是Mac Mini）</li>
</ul>
<h3 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h3><ul>
<li>Jenkins(Docker)：Pipeline构建平台</li>
<li>Node(v12.13.0) &amp; Npm(6.12.0)：编译工具</li>
<li>微信开发者工具：主要依赖工具</li>
<li>Nginx(Docker)：内网图片服务</li>
<li>Gitlab(Docker)：代码库</li>
</ul>
<p>关于Jenkins、Gitlab，以及Jenkins的扩展共享库，请参考下面的链接<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7a88c8f1f84b">Jenkins Pipeline系列（一）– 如何配置扩展共享库</a></p>
<h1 id="流程说明"><a href="#流程说明" class="headerlink" title="流程说明"></a>流程说明</h1><p><img src="/images/2020-11/mini-program-flow.jpg"></p>
<ul>
<li>编译</li>
<li>预览（按需登录）</li>
<li>上传（按需登录）</li>
</ul>
<h1 id="Pipeline实现"><a href="#Pipeline实现" class="headerlink" title="Pipeline实现"></a>Pipeline实现</h1><p>这里还是使用的是Jenkins的扩展共享库来实现的，在上面有共享扩展库的文章说明，请参考<br>在共享扩展库的Git Repo的vars目录下新建wechat_mini_program_build.groovy，内容如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">配置参数说明：</span></span><br><span class="line"><span class="comment">--------------------------------------------------------------</span></span><br><span class="line"><span class="comment">参数名称: REPO_URL</span></span><br><span class="line"><span class="comment">参数类型: 文本参数</span></span><br><span class="line"><span class="comment">默认值: ssh://git@gitlab.xxx.com/group_name/repo_name.git</span></span><br><span class="line"><span class="comment">描述: 项目代码仓库地址</span></span><br><span class="line"><span class="comment">--------------------------------------------------------------</span></span><br><span class="line"><span class="comment">参数名称: BUILD_BRANCH</span></span><br><span class="line"><span class="comment">参数类型: 字符参数</span></span><br><span class="line"><span class="comment">默认值: some-branch</span></span><br><span class="line"><span class="comment">描述: 构建分支&lt;br&gt;</span></span><br><span class="line"><span class="comment">     some-branch&lt;br&gt;</span></span><br><span class="line"><span class="comment">     develop&lt;br&gt;</span></span><br><span class="line"><span class="comment">     release&lt;br&gt;</span></span><br><span class="line"><span class="comment">     master</span></span><br><span class="line"><span class="comment">--------------------------------------------------------------</span></span><br><span class="line"><span class="comment">参数名称: BUILD_ENV</span></span><br><span class="line"><span class="comment">参数类型: Active Choices Parameter</span></span><br><span class="line"><span class="comment">Groovy Script: return[&quot;请选择&quot;,&quot;dev&quot;,&quot;test&quot;,&quot;prod&quot;]</span></span><br><span class="line"><span class="comment">描述: dev开发环境&lt;br&gt;</span></span><br><span class="line"><span class="comment">     test测试环境&lt;br&gt;</span></span><br><span class="line"><span class="comment">     prod生产环境</span></span><br><span class="line"><span class="comment">--------------------------------------------------------------</span></span><br><span class="line"><span class="comment">参数名称: BUILD_TYPE</span></span><br><span class="line"><span class="comment">参数类型: 选型参数</span></span><br><span class="line"><span class="comment">选型: preview</span></span><br><span class="line"><span class="comment">     upload</span></span><br><span class="line"><span class="comment">描述: preview: 预览生成二维码&lt;br&gt;</span></span><br><span class="line"><span class="comment">     upload: 上传代码</span></span><br><span class="line"><span class="comment">--------------------------------------------------------------</span></span><br><span class="line"><span class="comment">参数名称: UPLOAD_VERSION</span></span><br><span class="line"><span class="comment">参数类型: 字符参数</span></span><br><span class="line"><span class="comment">默认值: </span></span><br><span class="line"><span class="comment">描述: 上传代码版本号: 如 2.0.0&lt;br&gt;</span></span><br><span class="line"><span class="comment">     只有upload任务需要</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">def</span> call(Map config) &#123;</span><br><span class="line">    node(<span class="string">&#x27;front-end&#x27;</span>) &#123;</span><br><span class="line">        properties([</span><br><span class="line">            buildDiscarder(</span><br><span class="line">              logRotator(</span><br><span class="line">                  <span class="symbol">daysToKeepStr:</span> <span class="string">&#x27;30&#x27;</span>,</span><br><span class="line">                  <span class="symbol">numToKeepStr:</span> <span class="string">&#x27;50&#x27;</span></span><br><span class="line">              )</span><br><span class="line">          )</span><br><span class="line">        ])</span><br><span class="line">        stage(<span class="string">&#x27;清理工作区&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&#x27;清理工作区&#x27;</span></span><br><span class="line">            deleteDir()</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;获取代码&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&quot;获取代码地址:$&#123;REPO_URL&#125;,获取代码分支: $&#123;BUILD_BRANCH&#125;&quot;</span></span><br><span class="line">            fetch_code <span class="string">&quot;$&#123;REPO_URL&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;编译&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&quot;构建:$&#123;BUILD_ENV&#125;&quot;</span></span><br><span class="line">            sh <span class="string">&quot;source ~/.bash_profile &amp;&amp; npm install &amp;&amp; npm run build:$&#123;BUILD_ENV&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;替换APPID&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = getMiniProgramAppId(<span class="string">&quot;$&#123;BUILD_ENV&#125;&quot;</span>,config.projectName)</span><br><span class="line">            log.info <span class="string">&quot;替换数据:$&#123;BUILD_ENV&#125;,小程序APPID:$&#123;miniProgramAppId&#125;&quot;</span></span><br><span class="line">            sh <span class="string">&quot;sed -i &#x27;&#x27; &#x27;s/\&quot;appid\&quot;:.*/\&quot;appid\&quot;: \&quot;$&#123;miniProgramAppId&#125;\&quot;,/g&#x27; $&#123;WORKSPACE&#125;/dist/build/mp-weixin/project.config.json&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;预览&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(BUILD_TYPE == <span class="string">&#x27;preview&#x27;</span>)&#123;</span><br><span class="line">                log.info <span class="string">&quot;构建分支: $&#123;BUILD_BRANCH&#125;&quot;</span></span><br><span class="line">                wechatBinPath = <span class="string">&#x27;/Applications/wechatwebdevtools.app/Contents/MacOS&#x27;</span></span><br><span class="line">                sh <span class="string">&quot;$&#123;wechatBinPath&#125;/cli preview --project $&#123;WORKSPACE&#125;/dist/build/mp-weixin -f image -o $&#123;WORKSPACE&#125;/$&#123;BUILD_ID&#125;.jpg &gt; $&#123;WORKSPACE&#125;/build.log&quot;</span></span><br><span class="line">                errlog = sh(<span class="attr">returnStdout:</span> <span class="literal">true</span>, <span class="attr">script:</span> <span class="string">&quot;grep -i error: $&#123;WORKSPACE&#125;/build.log || echo&quot;</span>).trim()</span><br><span class="line">                log.info <span class="string">&quot;errlog:$&#123;errlog&#125;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;$&#123;errlog&#125;&quot;</span>==<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">                    log.info <span class="string">&#x27;执行成功&#x27;</span></span><br><span class="line">                    sh <span class="string">&quot;cp $&#123;WORKSPACE&#125;/$&#123;BUILD_ID&#125;.jpg /Users/guoguo/workspace/nginx/image&quot;</span></span><br><span class="line">                    buildDesc = <span class="string">&quot;代码分支: $&#123;BUILD_BRANCH&#125;&lt;br&gt;构建环境: $&#123;BUILD_ENV&#125;&lt;br&gt;构建类型: $&#123;BUILD_TYPE&#125;&lt;br&gt;请使用微信扫描以下二维码进行预览: &lt;br&gt;&lt;img src=\&quot;http://图片服务器地址/$&#123;BUILD_ID&#125;.jpg\&quot; width=\&quot;200\&quot; height=\&quot;200\&quot;&gt;&quot;</span></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    log.error <span class="string">&#x27;执行失败&#x27;</span></span><br><span class="line">                    closeTool()</span><br><span class="line">                    buildDesc = <span class="string">&#x27;微信开发者工具登录失效，请登录后再执行&lt;br&gt;登录工具:&lt;a href=\&quot;$&#123;JENKINS_URL&#125;/job/WECHAT_LOGIN_TOOL\&quot;&gt;&#x27;</span></span><br><span class="line">                    sh <span class="string">&quot;exit 1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                log.info <span class="string">&#x27;不是预览任务，跳过&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;上传&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(BUILD_TYPE == <span class="string">&#x27;upload&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(BUILD_ENV == <span class="string">&#x27;prod&#x27;</span> &amp;&amp; BUILD_BRANCH != <span class="string">&#x27;master&#x27;</span>)&#123;</span><br><span class="line">                    log.error <span class="string">&#x27;PROD环境只能允许master分支上传&#x27;</span></span><br><span class="line">                    sh <span class="string">&quot;exit 1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">                log.info <span class="string">&quot;构建分支: $&#123;BUILD_BRANCH&#125;&quot;</span></span><br><span class="line">                wechatBinPath = <span class="string">&#x27;/Applications/wechatwebdevtools.app/Contents/MacOS&#x27;</span></span><br><span class="line">                now = getTimestamp()</span><br><span class="line">                uploadDesc = <span class="string">&quot;CI 在 $&#123;now&#125; 提交上传&quot;</span></span><br><span class="line">                sh <span class="string">&quot;$&#123;wechatBinPath&#125;/cli upload --project $&#123;WORKSPACE&#125;/dist/build/mp-weixin -v &#x27;$&#123;UPLOAD_VERSION&#125;&#x27; -d &#x27;$&#123;uploadDesc&#125;&#x27; &gt; $&#123;WORKSPACE&#125;/upload.log&quot;</span></span><br><span class="line">                errlog = sh(<span class="attr">returnStdout:</span> <span class="literal">true</span>, <span class="attr">script:</span> <span class="string">&quot;grep -i error: $&#123;WORKSPACE&#125;/upload.log || echo&quot;</span>).trim()</span><br><span class="line">                log.info <span class="string">&quot;errlog:$&#123;errlog&#125;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;$&#123;errlog&#125;&quot;</span>==<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">                    log.info <span class="string">&#x27;上传成功&#x27;</span></span><br><span class="line">                    buildDesc = <span class="string">&quot;代码分支: $&#123;BUILD_BRANCH&#125;&lt;br&gt;构建环境: $&#123;BUILD_ENV&#125;&lt;br&gt;构建类型: $&#123;BUILD_TYPE&#125;&quot;</span></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    log.error <span class="string">&#x27;上传失败&#x27;</span></span><br><span class="line">                    closeTool()</span><br><span class="line">                    buildDesc = <span class="string">&#x27;微信开发者工具登录失效，请登录后再执行&lt;br&gt;登录工具:&lt;a href=\&quot;$&#123;JENKINS_URL&#125;/job/登录工具JOB\&quot;&gt;&#x27;</span></span><br><span class="line">                    sh <span class="string">&quot;exit 1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                log.info <span class="string">&#x27;不是上传任务，跳过&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;关闭工具&#x27;</span>)&#123;</span><br><span class="line">            closeTool()</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;通知&#x27;</span>) &#123;</span><br><span class="line">            dingding.notice(<span class="string">&quot;$&#123;BUILD_BRANCH&#125;&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        currentBuild.description = <span class="string">&quot;$&#123;buildDesc&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getMiniProgramAppId(buildEnv,projectEnglishName)&#123;</span><br><span class="line">    <span class="keyword">if</span>(projectEnglishName == <span class="string">&#x27;应用A&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(buildEnv == <span class="string">&#x27;dev&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(buildEnv == <span class="string">&#x27;test&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(buildEnv == <span class="string">&#x27;prod&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(projectEnglishName == <span class="string">&#x27;应用B&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(buildEnv == <span class="string">&#x27;dev&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(buildEnv == <span class="string">&#x27;test&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(buildEnv == <span class="string">&#x27;prod&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(projectEnglishName == <span class="string">&#x27;应用C&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(buildEnv == <span class="string">&#x27;dev&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(buildEnv == <span class="string">&#x27;test&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(buildEnv == <span class="string">&#x27;prod&#x27;</span>)&#123;</span><br><span class="line">            miniProgramAppId = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> miniProgramAppId</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> closeTool()&#123;</span><br><span class="line">    log.info <span class="string">&quot;关闭工具&quot;</span></span><br><span class="line">    sh <span class="string">&quot;$&#123;wechatBinPath&#125;/cli quit&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getTimestamp() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Date().format(<span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Jenkins新建JOB，类型选择Pipeline，按照上面脚本注释内的“配置参数说明”，录入参数，并在最下面，Pipeline script填写如下内容，点击保存：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Library</span>(<span class="string">&#x27;jenkins-shared-libraries@master&#x27;</span>) _</span><br><span class="line"></span><br><span class="line">node &#123;</span><br><span class="line">    script &#123;</span><br><span class="line">        wechat_mini_program_build(</span><br><span class="line">            <span class="symbol">projectName:</span><span class="string">&#x27;你的项目名称&#x27;</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打开任务执行，参数如下：<br><img src="/images/2020-11/mini-program-pipeline-build.jpg"></p>
<p>预览任务执行后的样子如下图，打包任务，基本一致，就是没有二维码而已：<br><img src="/images/2020-11/mini-program-result.jpg"></p>
<p>小程序的自动化任务，都是需要有登录态的（上面的任务，如果登录失效，会提示，用登录工具先登录），这里登录的动作必须由人工完成，下面是登录工具的Pipeline，vars 下面新建wechat_mini_program_login_tool.groovy</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> call() &#123;</span><br><span class="line">    node(<span class="string">&#x27;front-end&#x27;</span>) &#123;</span><br><span class="line">        properties([</span><br><span class="line">            buildDiscarder(</span><br><span class="line">              logRotator(</span><br><span class="line">                  <span class="symbol">daysToKeepStr:</span> <span class="string">&#x27;30&#x27;</span>,</span><br><span class="line">                  <span class="symbol">numToKeepStr:</span> <span class="string">&#x27;50&#x27;</span></span><br><span class="line">              )</span><br><span class="line">          )</span><br><span class="line">        ])</span><br><span class="line">        stage(<span class="string">&#x27;登录&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&quot;登录&quot;</span></span><br><span class="line">            imagePath = <span class="string">&#x27;/你的图片Nginx目录&#x27;</span></span><br><span class="line">            wechatBinPath = <span class="string">&#x27;/Applications/wechatwebdevtools.app/Contents/MacOS&#x27;</span></span><br><span class="line">            sh <span class="string">&quot;$&#123;wechatBinPath&#125;/cli login -f image -o $&#123;imagePath&#125;/login-$&#123;BUILD_ID&#125;.jpg &gt; $&#123;WORKSPACE&#125;/run.log 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line">            log.info <span class="string">&quot;请在60秒内打开链接并扫码(请使用专用微信): http://图片服务器地址/login-$&#123;BUILD_ID&#125;.jpg&quot;</span></span><br><span class="line">            sh <span class="string">&#x27;sleep 60&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Jenkins新建JOB，类型选择Pipeline，并在最下面，Pipeline script填写如下内容，点击保存：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Library</span>(<span class="string">&#x27;jenkins-shared-libraries@master&#x27;</span>) _</span><br><span class="line"></span><br><span class="line">node &#123;</span><br><span class="line">    script &#123;</span><br><span class="line">        wechat_mini_program_login_tool()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构建过程中，点击控制台打印的 http://图片服务器地址/login-${BUILD_ID}.jpg链接，进行扫描动作</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h3 id="已经解决问题"><a href="#已经解决问题" class="headerlink" title="已经解决问题"></a>已经解决问题</h3><ul>
<li>自动化编译</li>
<li>自动化预览</li>
<li>自动化上传代码</li>
</ul>
<h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><ul>
<li>自动从package.json读取版本号并做自动新增</li>
<li>自动MR / 自动Tag</li>
</ul>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p> <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/devtools/cli.html#%E8%87%AA%E5%8A%A8%E9%A2%84%E8%A7%88">微信小程序命令行说明</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/11/11/%E5%B0%8F%E5%9B%A2%E9%98%9F%E5%A6%82%E4%BD%95%E8%90%BD%E5%9C%B0%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/11/%E5%B0%8F%E5%9B%A2%E9%98%9F%E5%A6%82%E4%BD%95%E8%90%BD%E5%9C%B0%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/" class="post-title-link" itemprop="url">小团队如何落地敏捷开发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-11 14:06:02" itemprop="dateCreated datePublished" datetime="2020-11-11T14:06:02+08:00">2020-11-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>You can’t manage what you don’t measure. - Peter Drucker</p>
<p>你如果无法度量它，就无法管理它。</p>
<p>这是现代管理学之父，彼得·德鲁克的一句名言。项目管理、敏捷开发的前提，还是需要把数据串起来，进行可视化、数据化，这样才能看到它，管理它。</p>
<p>本文将以公司SaaS产品为例，介绍下“小团队”是如何进行敏捷研发的落地的。</p>
<h1 id="为什么要实施"><a href="#为什么要实施" class="headerlink" title="为什么要实施"></a>为什么要实施</h1><hr>
<ul>
<li>需求的进展不透明，不知道现在到哪里了</li>
<li>需求延期发布成为了家常便饭，不知道什么时候会发布上线</li>
<li>需求发布上线后，心里总是忐忑不安，不知道什么时候会出现问题和故障</li>
<li>团队沟通成本太高，经常性出现RD、FE、QA、PM信息不一致</li>
<li>需求插入随意、频繁，不计成本</li>
<li>不清楚，研发团队的工作量，是正常、超负荷、还是有人不饱和</li>
</ul>
<p>在互联网初创公司里，需求和有限的资源，永远是矛盾命题，如何在矛盾中寻找平衡，把有限的资源专注于符合公司战略的需求，保持团队的节奏和良好的情绪，就是要实施敏捷管理的痛点，也是我们为什么要实施，敏捷管理也可以很好的回答上面出现的各种问题，给出答案。</p>
<h1 id="使用的工具"><a href="#使用的工具" class="headerlink" title="使用的工具"></a>使用的工具</h1><hr>
<p>下面是我们所使用的工具，Confluence主要是知识库和文档的汇集，JIRA是项目管理工具和BUG管理工具，下面是之前写的如何搭建这些工具的文章，大家可以参考</p>
<h2 id="✔️Atlassian-Confluence"><a href="#✔️Atlassian-Confluence" class="headerlink" title="✔️Atlassian Confluence"></a>✔️Atlassian Confluence</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bda2638fdbc2">创业公司基础设施如何搭建（三） – Confluence（Docker版本）</a></p>
<h2 id="✔️Atlassian-Jira"><a href="#✔️Atlassian-Jira" class="headerlink" title="✔️Atlassian Jira"></a>✔️Atlassian Jira</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/093cf14361ed">创业公司基础设施如何搭建（四） – Jira（Docker版本）</a></p>
<h1 id="如何做好这件事情"><a href="#如何做好这件事情" class="headerlink" title="如何做好这件事情"></a>如何做好这件事情</h1><hr>
<p>需求评审 ➡️ 设计评审 ➡️ 研发实现 ➡️ 测试 ➡️ 验收 ➡️ 发布 ➡️ 后评估</p>
<p>为了让产品和研发过程可视化，更加可控，信息互通，我们采用<strong>4个看板</strong>模型进行敏捷管理实践，看板名称和功能如下：</p>
<blockquote>
<p>公开需求看板（Kanban Board）</p>
</blockquote>
<hr>
<p>通过「看板」建立一个公开需求池，向跨部门成员广泛收集需求，一切市场反馈及时传递到位。看板类型为Kanban Board。</p>
<p><img src="/images/2020-11/kanban-01.jpg"></p>
<blockquote>
<p>需求看板（Kanban Board）</p>
</blockquote>
<hr>
<p>为需求生命周期搭建流程，按「Backlog - 评审 - 排期 - 设计 - 开发 - 发布」设立多个阶段，需求流转可视化。<br><img src="/images/2020-11/kanban-02.jpg"></p>
<blockquote>
<p>任务效能看板（Scrum Board）</p>
</blockquote>
<hr>
<p>为需求预设好发版时间，所有人都可以及时预知逾期风险；产品、开发和需求提出者随时发起沟通，及时同步需求变化或者开发进展。<br><img src="/images/2020-11/kanban-03.jpg"></p>
<blockquote>
<p>BUG看板（Kanban Board）</p>
</blockquote>
<hr>
<p>通过看板查询，迭代中的各种类型的BUG数量情况，清楚明了。<br><img src="/images/2020-11/kanban-04.jpg"></p>
<h1 id="公开需求管理"><a href="#公开需求管理" class="headerlink" title="公开需求管理"></a>公开需求管理</h1><hr>
<p>公司属于教育类SaaS，其公开需求主要来源有下面几类：</p>
<ul>
<li>重要客户（学校）</li>
<li>用户日常使用反馈（教师、学生、家长）</li>
<li>销售渠道</li>
</ul>
<p>甄别和过滤伪需求和次要或者不符合战略的需求，在这里进行，但是“业务方”提出的众多的需求如何管理，也是一件头疼的事情，这里主要流程发生有下列几种：</p>
<ul>
<li><strong>用户使用体验  ➡️ 客户成功同学  ➡️ 记录问题  ➡️ 反馈处理结果</strong></li>
<li><strong>大客户需求</strong>  <strong>➡️ 客户成功同学  ➡️ 记录问题  ➡️ 反馈处理结果</strong></li>
</ul>
<p>客户成功同学、销售同学或者其他干系人，都可以在这个看板内，提交原始需求问题，产品同学会过滤、调研，转化为产品需求，到产品需求池内，下面是**<em>公开需求看板**</em>，卡片的内容主要包含了：需求描述、问题类型、解决状态、经办人</p>
<p><img src="/images/2020-11/kanban-05.jpg"></p>
<ul>
<li>判断价值很低或者肯定不会做的需求，直接拖到已完成</li>
<li>判断有一定价值或需要在分析的需求，拖到调研讨论，最终确定后，再拖到已完成</li>
</ul>
<h1 id="产品研发需求管理"><a href="#产品研发需求管理" class="headerlink" title="产品研发需求管理"></a>产品研发需求管理</h1><hr>
<blockquote>
<p>需求分类</p>
</blockquote>
<hr>
<p>产品研发内部，我们把需求分成2类：</p>
<ul>
<li>产品需求：PM提出的迭代、紧急、日常类需求</li>
<li>技术需求：研发内部为了稳定性、扩展性、维护性而进行的技术重构类需求</li>
</ul>
<blockquote>
<p>需求等级</p>
</blockquote>
<hr>
<p>古语云：师出有名，需求的提出也是如此，为了让研发同学知道需求的重要和紧急程度，需求等级划分是特别需要的一件事情。</p>
<ul>
<li><p>产品需求等级划分</p>
<p>  P0：紧急任务，必须穷尽所能，最短时间完成；可以调人支援，可以停止其他项目，需要加班</p>
<p>  P1：非常重要任务，有Deadline，并且不可以Delay；如遇到P0，那么就需要加班保证P1的Deadline</p>
<p>  P2：重要、有影响力的任务，有Deadline，如遇到P0和P1，可以顺延（应该是大部分任务）</p>
<p>  P3：锦上添花的正常任务，优先级最低</p>
</li>
<li><p>技术需求等级划分</p>
<p>  T0：重大性能和漏洞，需要加班加点进行修复</p>
<p>  T1：扩展性和性能风险问题，一般是单独任务进行修复</p>
<p>  T2：设计或者一般性能缺陷，一般是随着迭代进行相关改进</p>
</li>
</ul>
<blockquote>
<p>产品需求管理（需求看板）</p>
</blockquote>
<hr>
<p>PM和研发同学，通过PRD的方式进行沟通和交流，研发同学最终也是通过PRD进行开发、测试工作，所以第一步是需要创建PRD，PRD的管理方式采用相对灵活的方式，PM写PRD的工具有的是蓝湖，有的墨刀，我们这里为了统一归档，在Confluence做了归档的统一管理（PRD的详细链接可以是任何工具的链接）， 在Confluence创建时选择模板创建，见下图：<br><img src="/images/2020-11/prd-01.jpg"></p>
<p><img src="/images/2020-11/prd-02.jpg"></p>
<p>主要包含了</p>
<ul>
<li><p>背景描述</p>
</li>
<li><p>业务目标的描述</p>
</li>
<li><p>需求链接和功能列表（即Story）</p>
<p>  <strong><em>需求看板</em></strong>的泳道有P0、P1、P1以下、技术需求的4个泳道，为了便于搜索，在快捷搜索列加入了常用的搜索关键词，卡片主要包含：需求等级、到期日、需求负责人<br><img src="/images/2020-11/kanban-06.jpg"></p>
</li>
</ul>
<blockquote>
<p>技术需求管理（需求看板）</p>
</blockquote>
<p>类似数据结构的变更、技术架构的改进，比如：更换配置中心为Apollo，这类需要简称技术需求，其数据显示和看板功能，和产品需求基本一致，也显示在 <strong><em>需求看板</em></strong> 内，看板如下：<br><img src="/images/2020-11/kanban-07.jpg"></p>
<h1 id="技术任务管理（任务效能看板）"><a href="#技术任务管理（任务效能看板）" class="headerlink" title="技术任务管理（任务效能看板）"></a>技术任务管理（任务效能看板）</h1><p>这个阶段，主要是从需求阶段进入到了研发阶段，这个阶段主要包含如下类型的任务：</p>
<ul>
<li>开发任务：RD、FE</li>
<li>开发自测：RD、FE</li>
<li>测试用例编写：QA</li>
<li>测试用例执行：QA</li>
</ul>
<p>技术任务类型的问题，主要来源于2个方面</p>
<ul>
<li>产品需求</li>
<li>技术需求</li>
</ul>
<p>对于此类任务管理，我们使用的看板是 <strong><em>任务效能看板</em></strong>。在开始之前，我们需要在Backlog内，拖动需要进行迭代的技术需求或产品需求，如下图：<br><img src="/images/2020-11/kanban-08.jpg"></p>
<p>然后，以产品需求和技术需求为父任务，在 <strong><em>需求看板</em></strong>内，创建子任务，界面如下：<br><img src="/images/2020-11/kanban-09.jpg"></p>
<p>创建好后，可以查看父子任务详情，并有工作量体现<br><img src="/images/2020-11/kanban-10.jpg"></p>
<p>点击开始Sprint，并设置好时间，如下图：<br><img src="/images/2020-11/kanban-11.jpg"></p>
<p>RD &amp; QA &amp; FE，在每天下班前，填写其任务的工作量即可达到任务工作量跟踪的效果，如下图：<br><img src="/images/2020-11/kanban-12.jpg"></p>
<h1 id="测试BUG管理（BUG看板）"><a href="#测试BUG管理（BUG看板）" class="headerlink" title="测试BUG管理（BUG看板）"></a>测试BUG管理（BUG看板）</h1><hr>
<p>在Sprint中产生的BUG都会显示在 <strong><em>BUG看板</em></strong>中，工作流主要是打开 ➡️ 处理中 ➡️ 已解决 ➡️  已关闭，如下图：<br><img src="/images/2020-11/kanban-13.jpg"></p>
<p>我们所采用的BUG类的问题类型有以下几种：</p>
<ul>
<li><p>功能错误</p>
</li>
<li><p>界面优化</p>
</li>
<li><p>功能优化</p>
</li>
<li><p>性能问题</p>
</li>
<li><p>安全相关</p>
<p>  在这个迭代结束后，测试人员，会根据BUG的统计报告数据，分析得出本次迭代的测试报告，测试报告，我们在Confluence创建了统一模板，主要内容如下：<br><img src="/images/2020-11/test-report-01.jpg"><br><img src="/images/2020-11/test-report-02.jpg"></p>
</li>
</ul>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><hr>
<p>需求和效能的生命周期管理，这里仅仅是按照目前产品和团队的需求和阶段，规定了一些适合我们的方法，这个周期管理，还是需要随着人员和阶段的不同而进行不断的改造和演进的，下面是我们在JIRA和Confluence使用的一些核心流程和方法：</p>
<ul>
<li><p>4个看板</p>
<p>  公开需求看板：处理市场、销售前端部门提出的“大客户需求”和“用户使用体验问题”</p>
<p>  需求看板：主要是管理技术需求和产品需求</p>
<p>  任务效能看板：主要是管理开发阶段，RD &amp; FE &amp; QA的任务和工作量，跟踪其任务合理性</p>
<p>  BUG看板：主要是管理迭代内产生的5类BUG问题，功能优化 &amp; 功能错误 &amp; 界面优化 &amp; 性能问题 &amp; 安全相关</p>
</li>
<li><p>2个模板</p>
<p>  产品需求模板：产品需求的管理</p>
<p>  测试报告模块：迭代后，针对BUG和其他问题，进行的测试相关的总结</p>
<p>  目前，敏捷相关的管理，这个阶段也仅仅是做了一小部分，还有很多实践方法，在后续的变化中，会加入和实施</p>
<p>  敏捷管理是为了快速、稳定的交付产品而服务的，切忌不要为了追求敏捷工具的使用而耽误了实际要达成的目标。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/10/07/Jenkins%20Pipeline%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94%20%E4%BD%BF%E7%94%A8%E6%89%A9%E5%B1%95%E5%85%B1%E4%BA%AB%E5%BA%93%E6%9E%84%E5%BB%BAMaven%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/07/Jenkins%20Pipeline%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94%20%E4%BD%BF%E7%94%A8%E6%89%A9%E5%B1%95%E5%85%B1%E4%BA%AB%E5%BA%93%E6%9E%84%E5%BB%BAMaven%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">Jenkins Pipeline系列（二）—— 使用扩展共享库构建Maven项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-07 11:29:10" itemprop="dateCreated datePublished" datetime="2020-10-07T11:29:10+08:00">2020-10-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Jenkins-Pipeline-Maven-Project"><a href="#Jenkins-Pipeline-Maven-Project" class="headerlink" title="Jenkins Pipeline Maven Project"></a>Jenkins Pipeline Maven Project</h1><p>用代码的方式，管理日常的构建</p>
<h1 id="Maven-Project构建的阶段（简单流程）"><a href="#Maven-Project构建的阶段（简单流程）" class="headerlink" title="Maven Project构建的阶段（简单流程）"></a>Maven Project构建的阶段（简单流程）</h1><ol>
<li>清理工作区</li>
<li>获取code</li>
<li>加载CI配置文件</li>
<li>打包</li>
<li>工件归档</li>
<li>部署或其他操作</li>
<li>通知构建结果（这里用的是钉钉）</li>
</ol>
<p>上面仅仅是针对一般类型项目进行的构建阶段说明，可以针对自己的要求进行增减（还可以包含docker镜像的打包、推送私服、git tag等等）</p>
<h1 id="Maven-Demo-Project"><a href="#Maven-Demo-Project" class="headerlink" title="Maven Demo Project"></a>Maven Demo Project</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── app                   # 主要的code存放module</span><br><span class="line">├── assembly              # 打包module</span><br><span class="line">├── commitlint.config.js  # git commit message插件配置</span><br><span class="line">├── config                # 相关yml properties配置module</span><br><span class="line">├── jenkins.groovy        # Jenkins Pipeline调用的配置文件</span><br><span class="line">├── maven                 # mvnw</span><br><span class="line">├── mvnw</span><br><span class="line">├── mvnw.bat</span><br><span class="line">├── package.json          # git commit 依赖包相关</span><br><span class="line">└── pom.xml</span><br></pre></td></tr></table></figure>

<p>上图是标准的Maven多module项目结构，其中有一个jenkins.groovy是和Jenkins Pipeline相关的</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打包配置文件，配置打包相关信息，CI打包的时候会加载这个文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 项目名称</span></span><br><span class="line">env.PROJECT_CHINESE_NAME = <span class="string">&quot;michael的测试项目&quot;</span></span><br><span class="line"><span class="comment">// 英文名字，用于产物命名，不要随意修改</span></span><br><span class="line">env.PROJECT_ENGLISH_NAME = <span class="string">&quot;michael-jenkins-pipeline-demo&quot;</span></span><br><span class="line"><span class="comment">// 归档文件正则，如：*.jar</span></span><br><span class="line">env.ARCH_FILE_PATTERN = <span class="string">&quot;assembly/target/michael-jenkins-pipeline-demo-deploy.zip&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="Pipeline-Scripts"><a href="#Pipeline-Scripts" class="headerlink" title="Pipeline Scripts"></a>Pipeline Scripts</h1><h2 id="辅助脚本"><a href="#辅助脚本" class="headerlink" title="辅助脚本"></a>辅助脚本</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 在vars新建fetch_code.groovy</span><br><span class="line"># BUILD_BRANCH为输入参数</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> call(GIT_URL) &#123;</span><br><span class="line">    git <span class="attr">branch:</span> <span class="string">&quot;$&#123;BUILD_BRANCH&#125;&quot;</span>,</span><br><span class="line">    <span class="symbol">credentialsId:</span> <span class="string">&#x27;你的凭证&#x27;</span>,</span><br><span class="line">    <span class="symbol">url:</span> <span class="string">&quot;$&#123;GIT_URL&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 在vars新建log.groovy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> info(message) &#123;</span><br><span class="line">    echo <span class="string">&quot;INFO: $&#123;message&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> warning(message) &#123;</span><br><span class="line">    echo <span class="string">&quot;WARNING: $&#123;message&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> error(message) &#123;</span><br><span class="line">    echo <span class="string">&quot;ERROR: $&#123;message&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 在vars新建dingding.groovy</span><br><span class="line"><span class="keyword">def</span> notice(branch) &#123;</span><br><span class="line">    duration = currentBuild.duration / <span class="number">1000</span></span><br><span class="line">    statusMessage = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    buildStatusMessage = currentBuild.currentResult</span><br><span class="line">    <span class="keyword">if</span>(buildStatusMessage == <span class="string">&#x27;SUCCESS&#x27;</span>) &#123;</span><br><span class="line">        statusMessage=<span class="string">&quot;**&lt;font color=red&gt;成功&lt;/font&gt;**&quot;</span></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        statusMessage=<span class="string">&quot;**&lt;font color=red&gt;失败&lt;/font&gt;**&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    dingtalk (</span><br><span class="line">        <span class="symbol">robot:</span> <span class="string">&#x27;机器人code&#x27;</span>,</span><br><span class="line">        <span class="symbol">type:</span> <span class="string">&#x27;MARKDOWN&#x27;</span>,</span><br><span class="line">        <span class="symbol">atAll:</span> <span class="literal">false</span>,</span><br><span class="line">        <span class="symbol">title:</span> <span class="string">&quot;$&#123;JOB_NAME&#125; BUILD&quot;</span>,</span><br><span class="line">        <span class="symbol">text:</span>[</span><br><span class="line">        <span class="string">&quot;# 【$&#123;JOB_NAME&#125;】构建完成&quot;</span>,</span><br><span class="line">        <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;---&quot;</span>,</span><br><span class="line">        <span class="string">&quot;构建结果: $&#123;statusMessage&#125;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;&gt; [查看控制台]($&#123;BUILD_URL&#125;)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;- 构建分支: $&#123;branch&#125;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;- 构建用时: $&#123;duration&#125; 秒&quot;</span></span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="构建脚本"><a href="#构建脚本" class="headerlink" title="构建脚本"></a>构建脚本</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Config &#123;</span></span><br><span class="line"><span class="comment">    deployPath: 部署路径</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">def</span> call(Map config) &#123;</span><br><span class="line">    node(<span class="string">&#x27;java&#x27;</span>) &#123;</span><br><span class="line">        properties([</span><br><span class="line">            buildDiscarder(</span><br><span class="line">                logRotator(</span><br><span class="line">                    <span class="symbol">daysToKeepStr:</span> <span class="string">&#x27;30&#x27;</span>,</span><br><span class="line">                    <span class="symbol">numToKeepStr:</span> <span class="string">&#x27;50&#x27;</span></span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">        ])</span><br><span class="line">        stage(<span class="string">&#x27;清理工作区&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&#x27;清理工作区&#x27;</span></span><br><span class="line">            deleteDir()</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;获取代码&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&quot;获取代码地址:$&#123;REPO_URL&#125;,获取代码分支: $&#123;BUILD_BRANCH&#125;&quot;</span></span><br><span class="line">            fetch_code <span class="string">&quot;$&#123;REPO_URL&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;加载CI配置文件&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&quot;加载CI配置文件&quot;</span></span><br><span class="line">            jenkinsConfigFile=<span class="string">&quot;./jenkins.groovy&quot;</span></span><br><span class="line">            <span class="keyword">if</span> (fileExists(<span class="string">&quot;$&#123;jenkinsConfigFile&#125;&quot;</span>)) &#123;</span><br><span class="line">                load <span class="string">&quot;$&#123;jenkinsConfigFile&#125;&quot;</span></span><br><span class="line">                log.info <span class="string">&quot;找到打包参数文件$&#123;jenkinsConfigFile&#125;，加载成功&quot;</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                log.error <span class="string">&quot;$&#123;jenkinsConfigFile&#125;不存在,请在项目$&#123;jenkinsConfigFile&#125;里面配置打包参数&quot;</span></span><br><span class="line">                sh <span class="string">&quot;exit 1&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;构建&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&#x27;构建&#x27;</span></span><br><span class="line">            sh <span class="string">&quot;mvn wrapper:wrapper &amp;&amp; ./mvnw clean package -Dmaven.test.skip=true&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;工件归档&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&#x27;工件归档&#x27;</span></span><br><span class="line">            archive_file = <span class="string">&quot;$&#123;ARCH_FILE_PATTERN&#125;&quot;</span></span><br><span class="line">            echo <span class="string">&quot;Archive $&#123;archive_file&#125;&quot;</span></span><br><span class="line">            archiveArtifacts <span class="attr">artifacts:</span> <span class="string">&quot;$&#123;archive_file&#125;&quot;</span>, <span class="attr">fingerprint:</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;部署 OR 其他操作&#x27;</span>) &#123;</span><br><span class="line">            log.info <span class="string">&quot;部署分支: $&#123;BUILD_BRANCH&#125;&quot;</span></span><br><span class="line">            <span class="comment">// 进行对象的部署获取其他操作</span></span><br><span class="line">            currentBuild.description = <span class="string">&quot;代码分支: $&#123;BUILD_BRANCH&#125;&lt;br&gt;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;通知&#x27;</span>) &#123;</span><br><span class="line">            dingding.notice(<span class="string">&quot;$&#123;BUILD_BRANCH&#125;&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/04/19/Jenkins%20Pipeline%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%20%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%89%A9%E5%B1%95%E5%85%B1%E4%BA%AB%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/19/Jenkins%20Pipeline%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%20%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%89%A9%E5%B1%95%E5%85%B1%E4%BA%AB%E5%BA%93/" class="post-title-link" itemprop="url">Jenkins Pipeline系列（一）—— 如何配置扩展共享库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-19 21:22:52" itemprop="dateCreated datePublished" datetime="2020-04-19T21:22:52+08:00">2020-04-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="什么是扩展共享库"><a href="#什么是扩展共享库" class="headerlink" title="什么是扩展共享库"></a>什么是扩展共享库</h1><p>在工作中，我们可能会有很多Maven项目的打包部署，还有Android、iOS等等的打包任务，虽然项目不同，但是打包、部署等等流程有很多相似之处，扩展库共享库允许我们抽象出很多公共部分，这样后续在新项目配置Pipeline的时候，会非常简便</p>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><ul>
<li>Jenkins：安装建议参考<a target="_blank" rel="noopener" href="https://jenkins.io/zh/doc/book/installing/">Jenkins安装</a></li>
<li>Gitlab：安装建议参考<a target="_blank" rel="noopener" href="https://about.gitlab.com/install/">Gitlab安装</a><br>为了方便，我这里都选择Docker安装，请大家自行配置Gitlab和Jenkins相关参数，比如Gitlab的SSH Key，Jenkins的凭证，这里不做赘述</li>
</ul>
<h1 id="扩展共享库配置"><a href="#扩展共享库配置" class="headerlink" title="扩展共享库配置"></a>扩展共享库配置</h1><h2 id="创建Gitlab-Repo"><a href="#创建Gitlab-Repo" class="headerlink" title="创建Gitlab Repo"></a>创建Gitlab Repo</h2><ul>
<li>如图，我创建了名字是jenkins-shared-libraries的Git Repo<br><img src="/images/2020-04/git-repo.png"></li>
</ul>
<h2 id="目录说明"><a href="#目录说明" class="headerlink" title="目录说明"></a>目录说明</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(root)</span><br><span class="line">+- src                     <span class="comment"># Groovy 源码文件</span></span><br><span class="line">|   +- com</span><br><span class="line">|       +- michael</span><br><span class="line">|           +- Bar.groovy  <span class="comment"># for org.foo.Bar class，主要是类库相关</span></span><br><span class="line">+- vars                        <span class="comment"># 变量和公共过程</span></span><br><span class="line">|   +- foo.groovy          <span class="comment">#  全局&#x27;foo&#x27;变量</span></span><br><span class="line">|   +- foo.txt                 <span class="comment"># &#x27;foo&#x27; 变量的帮助文档</span></span><br><span class="line">+- resources               <span class="comment"># 资源文件 (external libraries only)</span></span><br><span class="line">|   +- com</span><br><span class="line">|       +- michael</span><br><span class="line">|           +- bar.json    <span class="comment"># static helper data for com.michael.Bar</span></span><br><span class="line">|           +- bar.shell   <span class="comment"># shell scripts</span></span><br><span class="line">|   +- package.json   <span class="comment"># 主要是Git commit message 插件</span></span><br><span class="line">|   +- commitlint.config.js   <span class="comment"># 主要是Git commit message 插件</span></span><br></pre></td></tr></table></figure>

<h2 id="配置Jenkins扩展共享库"><a href="#配置Jenkins扩展共享库" class="headerlink" title="配置Jenkins扩展共享库"></a>配置Jenkins扩展共享库</h2><ul>
<li>依次点击 系统管理 &gt; 系统配置，找到Global Pipeline Libraries，如下图<br><img src="/images/2020-04/jenkins-shared-lib.png"></li>
</ul>
<h2 id="编写Pipeline-Demo"><a href="#编写Pipeline-Demo" class="headerlink" title="编写Pipeline Demo"></a>编写Pipeline Demo</h2><p>在git的jenkins-shared-libraries中的vars下面，新建log.groovy文件，并提交</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def info(message) &#123;</span><br><span class="line">    echo &quot;INFO: $&#123;message&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def warning(message) &#123;</span><br><span class="line">    echo &quot;WARNING: $&#123;message&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def error(message) &#123;</span><br><span class="line">    echo &quot;ERROR: $&#123;message&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h2><ul>
<li>新建JOB<br><img src="/images/2020-04/jenkins-create-job.png"></li>
<li>执行JOB<br> 在Pipeline中引用共享库，并使用log.info的方法<br><img src="/images/2020-04/jenkins-pipeline.png"></li>
<li>执行结果<br><img src="/images/2020-04/jenkins-pipeline-result.png"></li>
</ul>
<p>PS：这里仅仅是最简单的Hello world的扩展库介绍，让大家有个感性认识，后面的文章，会针对Maven、Npm这些常见的打包部署方式的项目，进行Pipeline的扩展共享库的实践介绍。</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a target="_blank" rel="noopener" href="https://jenkins.io/zh/doc/book/installing/">Jenkins安装</a><br><a target="_blank" rel="noopener" href="https://about.gitlab.com/install/">Gitlab安装</a><br><a target="_blank" rel="noopener" href="https://jenkins.io/zh/doc/book/pipeline/shared-libraries/">Jenkins Shared-Libraries</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/03/16/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E4%BA%94%EF%BC%89%20%E2%80%94%E2%80%94%20Crowd%EF%BC%88Docker%E7%89%88%E6%9C%AC%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/16/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E4%BA%94%EF%BC%89%20%E2%80%94%E2%80%94%20Crowd%EF%BC%88Docker%E7%89%88%E6%9C%AC%EF%BC%89/" class="post-title-link" itemprop="url">创业公司基础设施如何搭建（五） —— Crowd（Docker版本）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-16 00:35:06" itemprop="dateCreated datePublished" datetime="2020-03-16T00:35:06+08:00">2020-03-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="集中式身份管理"><a href="#集中式身份管理" class="headerlink" title="集中式身份管理"></a>集中式身份管理</h1><p>Crowd从字面意思看就知道啥意思了，可以管理多种用户目录，如Active Directory、LDAP、OpenLDAP、Microsoft Azure AD等，单点登录 (SSO)，无缝集成 Jira、Confluence、Jenkins等等常用DevOps工具系统。</p>
<h1 id="工具包准备"><a href="#工具包准备" class="headerlink" title="工具包准备"></a>工具包准备</h1><ul>
<li>  版本: 3.2.1</li>
<li>  <a target="_blank" rel="noopener" href="https://www.atlassian.com/software/crowd/downloads/binary/atlassian-crowd-3.2.1.tar.gz">官方下载地址</a></li>
</ul>
<h1 id="安装启动方式"><a href="#安装启动方式" class="headerlink" title="安装启动方式"></a>安装启动方式</h1><p>需要准备</p>
<ul>
<li>Docker</li>
</ul>
<p>由于官方已经有镜像，我们在官方镜像上面加入自定义的内容即可，<a target="_blank" rel="noopener" href="https://bitbucket.org/atlassian-docker/docker-atlassian-crowd/src/3.2.1">官方3.2.1镜像Repo</a>，我们需要的是红框的2个文件，如下（Repo托管是bitbucket）：<br><img src="/images/2020-03/crowd-setup-1.png"></p>
<p>我在本地Mac上面建立了一个Docker Build目录，包含下面几个文件</p>
<ul>
<li>Dockerfile（上面的官方repo下载）</li>
<li>atlassian-crowd-3.2.1.tar.gz（官方二进制包，主要是Dockerfile里面的Curl自动下载的速度实在是慢的可以，我在提前下载好，COPY进去，这块不是非必须用这个包，可以依赖Dockerfile的Curl到官方下载安装包）</li>
<li>mysql-connector-java-5.1.45.jar（Mysql官网下载一个）</li>
<li>entrypoint.sh（上面的官方repo下载）<br>修改Dockerfile<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8-jdk-alpine</span><br><span class="line">MAINTAINER Dave Chevell</span><br><span class="line"></span><br><span class="line">ENV RUN_USER            daemon</span><br><span class="line">ENV RUN_GROUP           daemon</span><br><span class="line"></span><br><span class="line"># https://confluence.atlassian.com/crowd/important-directories-and-files-78676537.html</span><br><span class="line">ENV CROWD_HOME          /var/atlassian/application-data/crowd</span><br><span class="line">ENV CROWD_INSTALL_DIR   /opt/atlassian/crowd</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;$&#123;CROWD_HOME&#125;&quot;]</span><br><span class="line"></span><br><span class="line"># Expose HTTP port</span><br><span class="line">EXPOSE 8095</span><br><span class="line"></span><br><span class="line">WORKDIR $CROWD_HOME</span><br><span class="line"></span><br><span class="line">CMD [&quot;/entrypoint.sh&quot;, &quot;-fg&quot;]</span><br><span class="line">ENTRYPOINT [&quot;/sbin/tini&quot;, &quot;--&quot;]</span><br><span class="line"></span><br><span class="line">RUN apk add --no-cache wget curl openssh bash procps openssl perl ttf-dejavu tini</span><br><span class="line"></span><br><span class="line">COPY entrypoint.sh              /entrypoint.sh</span><br><span class="line"></span><br><span class="line">ARG CROWD_VERSION=3.2.1</span><br><span class="line"></span><br><span class="line">COPY atlassian-crowd-$&#123;CROWD_VERSION&#125;.tar.gz /tmp/atlassian-crowd-$&#123;CROWD_VERSION&#125;.tar.gz</span><br><span class="line">COPY mysql-connector-java-5.1.45.jar /tmp/mysql-connector-java-5.1.45.jar</span><br><span class="line"></span><br><span class="line">RUN mkdir -p                             $&#123;CROWD_INSTALL_DIR&#125; \</span><br><span class="line">    &amp;&amp; tar -xzvf /tmp/atlassian-crowd-$&#123;CROWD_VERSION&#125;.tar.gz -C $&#123;CROWD_INSTALL_DIR&#125; --strip-components=1 --no-same-owner \</span><br><span class="line">    &amp;&amp; mv /tmp/mysql-connector-java-5.1.45.jar $&#123;CROWD_INSTALL_DIR&#125;/crowd-webapp/WEB-INF/lib \</span><br><span class="line">    &amp;&amp; rm -rf /tmp/atlassian-crowd-$&#123;CROWD_VERSION&#125;.tar.gz \</span><br><span class="line">    &amp;&amp; chown -R $&#123;RUN_USER&#125;:$&#123;RUN_GROUP&#125; $&#123;CROWD_INSTALL_DIR&#125;/ \</span><br><span class="line">    &amp;&amp; sed -i -e &#x27;s/-Xms\([0-9]\+[kmg]\) -Xmx\([0-9]\+[kmg]\)/-Xms\$&#123;JVM_MINIMUM_MEMORY:=\1&#125; -Xmx\$&#123;JVM_MAXIMUM_MEMORY:=\2&#125; \$&#123;JVM_SUPPORT_RECOMMENDED_ARGS&#125; -Dcrowd.home=\$&#123;CROWD_HOME&#125;/g&#x27; $&#123;CROWD_INSTALL_DIR&#125;/apache-tomcat/bin/setenv.sh \</span><br><span class="line">    &amp;&amp; sed -i -e &#x27;s/port=&quot;8095&quot;/port=&quot;8095&quot; secure=&quot;$&#123;catalinaConnectorSecure&#125;&quot; scheme=&quot;$&#123;catalinaConnectorScheme&#125;&quot; proxyName=&quot;$&#123;catalinaConnectorProxyName&#125;&quot; proxyPort=&quot;$&#123;catalinaConnectorProxyPort&#125;&quot;/&#x27; $&#123;CROWD_INSTALL_DIR&#125;/apache-tomcat/conf/server.xml</span><br><span class="line"></span><br></pre></td></tr></table></figure>
执行build<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /your-docker-build-path</span><br><span class="line">docker build -t michael/atlassian-crowd:3.2.1 .</span><br></pre></td></tr></table></figure>
启动镜像（配套如果使用MYSQL，建议Docker Compose启动Jira + MYSQL）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --rm --name=&quot;crowd&quot; \</span><br><span class="line">-v /your-path/crowd:/var/atlassian/application-data/crowd  \</span><br><span class="line">-p 8095:8095 \</span><br><span class="line">-e &quot;JVM_MINIMUM_MEMORY=384m&quot;</span><br><span class="line">-e &quot;JVM_MAXIMUM_MEMORY=768m&quot;</span><br><span class="line">michael/atlassian-crowd:3.2.1</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/02/23/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E5%9B%9B%EF%BC%89%20%E2%80%94%E2%80%94%20Jira%EF%BC%88Docker%E7%89%88%E6%9C%AC%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/23/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E5%9B%9B%EF%BC%89%20%E2%80%94%E2%80%94%20Jira%EF%BC%88Docker%E7%89%88%E6%9C%AC%EF%BC%89/" class="post-title-link" itemprop="url">创业公司基础设施如何搭建（四） —— Jira（Docker版本）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-23 20:54:46" itemprop="dateCreated datePublished" datetime="2020-02-23T20:54:46+08:00">2020-02-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="项目与事务跟踪工具"><a href="#项目与事务跟踪工具" class="headerlink" title="项目与事务跟踪工具"></a>项目与事务跟踪工具</h1><p>Jira是做需求、Bug、任务等等管理的系统，工作流支持全部自定义，自由度极强，下面介绍下Jira的安装流程</p>
<h1 id="为什么是Jira"><a href="#为什么是Jira" class="headerlink" title="为什么是Jira"></a>为什么是Jira</h1><ul>
<li>缺陷跟踪</li>
<li>需求收集</li>
<li>流程审批</li>
<li>任务跟踪</li>
<li>项目跟踪和敏捷管理</li>
<li>完全自定义的workflow</li>
</ul>
<h1 id="工具包准备"><a href="#工具包准备" class="headerlink" title="工具包准备"></a>工具包准备</h1><ul>
<li>  版本: 7.10.0</li>
<li>  <a target="_blank" rel="noopener" href="https://www.atlassian.com/software/jira/download">官方下载地址</a></li>
</ul>
<h1 id="安装和启动"><a href="#安装和启动" class="headerlink" title="安装和启动"></a>安装和启动</h1><p>这里介绍2种安装和启动方式</p>
<ul>
<li>传统安装启动方式</li>
<li>Docker安装启动方式（推荐）</li>
</ul>
<h2 id="传统安装和启动"><a href="#传统安装和启动" class="headerlink" title="传统安装和启动"></a>传统安装和启动</h2><p>需要准备</p>
<ul>
<li>CentOS 7.x</li>
<li>JDK 1.8（配置好JAVA_HOME）</li>
<li>MYSQL 5.7.X（二进制安装或者Docker镜像）</li>
</ul>
<p><strong>一顿操作猛如虎。。。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">## 解压安装包</span><br><span class="line">cd your-path</span><br><span class="line">tar -xvf atlassian-jira-software-7.10.0.tar.gz</span><br><span class="line">mv /your-path/atlassian-jira-software-7.10.0-standalone/ /your-path/atlassian-jira-7.10.0</span><br><span class="line">## 配置环境变量JIRA_HOME</span><br><span class="line">vim ~/.zshrc #看大家用的什么系统，环境文件有所不同</span><br><span class="line">export JIRA_HOME=/tmp/jira-home</span><br><span class="line">## mysql的驱动Jar去官网下载一个适合5.7的即可</span><br><span class="line">cp mysql-connector-java-5.1.45.jar /your-path/atlassian-jira-7.10.0/atlassian-jira/WEB-INF/lib</span><br><span class="line">## 启动</span><br><span class="line">/your-path/atlassian-jira-7.10.0/bin/start-jira.sh</span><br><span class="line"># 默认是8080端口，在浏览器打开http://localhost:8080</span><br></pre></td></tr></table></figure>
<h2 id="Docker安装启动方式"><a href="#Docker安装启动方式" class="headerlink" title="Docker安装启动方式"></a>Docker安装启动方式</h2><p>需要准备</p>
<ul>
<li>Docker</li>
</ul>
<p>由于官方已经有镜像，我们在官方镜像上面加入自定义的内容即可，<a target="_blank" rel="noopener" href="https://github.com/cptactionhank/docker-atlassian-jira-software/tree/7.10.0">官方的7.10.0的Dockerfile的Repo地址</a>，我们需要的是红框的2个文件，如下：<br><img src="/images/2020-02/jira-setup-1.png"><br>我在本地Mac上面建立了一个Docker Build目录，包含下面几个文件</p>
<ul>
<li>Dockerfile（上面的官方repo下载）</li>
<li>atlassian-jira-software-7.10.0.tar.gz（官方二进制包，主要是Dockerfile里面的Curl自动下载的速度实在是慢的可以，我在提前下载好，COPY进去，这块不是非必须用这个包，可以依赖Dockerfile的Curl到官方下载安装包）</li>
<li>docker-entrypoint.sh（上面的官方repo下载）<br>修改Dockerfile<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8-alpine</span><br><span class="line"></span><br><span class="line"># Configuration variables.</span><br><span class="line">ENV JIRA_HOME     /var/atlassian/jira</span><br><span class="line">ENV JIRA_INSTALL  /opt/atlassian/jira</span><br><span class="line">ENV JIRA_VERSION  7.10.0</span><br><span class="line"></span><br><span class="line"># [新增]</span><br><span class="line">COPY atlassian-jira-software-$&#123;JIRA_VERSION&#125;.tar.gz /tmp/atlassian-jira-software-$&#123;JIRA_VERSION&#125;.tar.gz</span><br><span class="line"># [新增]</span><br><span class="line">RUN mkdir -p $&#123;JIRA_INSTALL&#125;</span><br><span class="line">RUN tar -xzvf /tmp/atlassian-jira-software-$&#123;JIRA_VERSION&#125;.tar.gz -C $&#123;JIRA_INSTALL&#125; --strip-components=1 --no-same-owner \</span><br><span class="line">    &amp;&amp; rm -rf /tmp/atlassian-jira-software-$&#123;JIRA_VERSION&#125;.tar.gz</span><br><span class="line"></span><br><span class="line"># Install Atlassian JIRA and helper tools and setup initial home</span><br><span class="line"># directory structure.</span><br><span class="line">RUN set -x \</span><br><span class="line">    &amp;&amp; apk add --no-cache curl xmlstarlet bash ttf-dejavu libc6-compat \</span><br><span class="line">    &amp;&amp; mkdir -p                &quot;$&#123;JIRA_HOME&#125;&quot; \</span><br><span class="line">    &amp;&amp; mkdir -p                &quot;$&#123;JIRA_HOME&#125;/caches/indexes&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;JIRA_HOME&#125;&quot; \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  &quot;$&#123;JIRA_HOME&#125;&quot; \</span><br><span class="line">    &amp;&amp; mkdir -p                &quot;$&#123;JIRA_INSTALL&#125;/conf/Catalina&quot; \</span><br><span class="line">    &amp;&amp; curl -Ls                &quot;https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.38.tar.gz&quot; | tar -xz --directory &quot;$&#123;JIRA_INSTALL&#125;/lib&quot; --strip-components=1 --no-same-owner &quot;mysql-connector-java-5.1.38/mysql-connector-java-5.1.38-bin.jar&quot; \</span><br><span class="line">    &amp;&amp; rm -f                   &quot;$&#123;JIRA_INSTALL&#125;/lib/postgresql-9.4.1212.jar&quot; \ # [修改] 之前的要删除的jar发现lib没有</span><br><span class="line">    &amp;&amp; curl -Ls                &quot;https://jdbc.postgresql.org/download/postgresql-42.2.1.jar&quot; -o &quot;$&#123;JIRA_INSTALL&#125;/lib/postgresql-42.2.1.jar&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;JIRA_INSTALL&#125;/conf&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;JIRA_INSTALL&#125;/logs&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;JIRA_INSTALL&#125;/temp&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;JIRA_INSTALL&#125;/work&quot; \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  &quot;$&#123;JIRA_INSTALL&#125;/conf&quot; \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  &quot;$&#123;JIRA_INSTALL&#125;/logs&quot; \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  &quot;$&#123;JIRA_INSTALL&#125;/temp&quot; \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  &quot;$&#123;JIRA_INSTALL&#125;/work&quot; \</span><br><span class="line">    &amp;&amp; sed --in-place          &quot;s/java version/openjdk version/g&quot; &quot;$&#123;JIRA_INSTALL&#125;/bin/check-java.sh&quot; \</span><br><span class="line">    &amp;&amp; echo -e                 &quot;\njira.home=$JIRA_HOME&quot; &gt;&gt; &quot;$&#123;JIRA_INSTALL&#125;/atlassian-jira/WEB-INF/classes/jira-application.properties&quot; \</span><br><span class="line">    &amp;&amp; touch -d &quot;@0&quot;           &quot;$&#123;JIRA_INSTALL&#125;/conf/server.xml&quot;</span><br><span class="line"></span><br><span class="line"># Use the default unprivileged account. This could be considered bad practice</span><br><span class="line"># on systems where multiple processes end up being executed by &#x27;daemon&#x27; but</span><br><span class="line"># here we only ever run one process anyway.</span><br><span class="line">USER daemon:daemon</span><br><span class="line"></span><br><span class="line"># Expose default HTTP connector port.</span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"># Set volume mount points for installation and home directory. Changes to the</span><br><span class="line"># home directory needs to be persisted as well as parts of the installation</span><br><span class="line"># directory due to eg. logs.</span><br><span class="line">VOLUME [&quot;/var/atlassian/jira&quot;, &quot;/opt/atlassian/jira/logs&quot;]</span><br><span class="line"></span><br><span class="line"># Set the default working directory as the installation directory.</span><br><span class="line">WORKDIR /var/atlassian/jira</span><br><span class="line"></span><br><span class="line">COPY &quot;docker-entrypoint.sh&quot; &quot;/&quot;</span><br><span class="line">ENTRYPOINT [&quot;/docker-entrypoint.sh&quot;]</span><br><span class="line"></span><br><span class="line"># Run Atlassian JIRA as a foreground process by default.</span><br><span class="line">CMD [&quot;/opt/atlassian/jira/bin/start-jira.sh&quot;, &quot;-fg&quot;]</span><br></pre></td></tr></table></figure>
执行build<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /your-docker-build-path</span><br><span class="line">docker build -t michael/atlassian-jira:7.10.0 .</span><br></pre></td></tr></table></figure>
启动镜像（配套如果使用MYSQL，建议Docker Compose启动Jira + MYSQL）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --rm --name=jira -p 8080:8080 \</span><br><span class="line">-v /Users/liuyang/CodeMonkey/workspace/docker-workspace/jira/home:/var/atlassian/jira \</span><br><span class="line">-v /Users/liuyang/CodeMonkey/workspace/docker-workspace/jira/logs:/opt/atlassian/jira/logs \</span><br><span class="line">michael/atlassian-jira:7.10.0</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/02/15/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E4%B8%89%EF%BC%89%20%E2%80%94%E2%80%94%20Confluence%EF%BC%88Docker%E7%89%88%E6%9C%AC%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/15/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E4%B8%89%EF%BC%89%20%E2%80%94%E2%80%94%20Confluence%EF%BC%88Docker%E7%89%88%E6%9C%AC%EF%BC%89/" class="post-title-link" itemprop="url">创业公司基础设施如何搭建（三） —— Confluence（Docker版本）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 00:56:08" itemprop="dateCreated datePublished" datetime="2020-02-15T00:56:08+08:00">2020-02-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="知识库"><a href="#知识库" class="headerlink" title="知识库"></a>知识库</h1><p>DevOps、敏捷管理，对于整体流程和团队，2个工具是最不能少的，而且使用频率非常高，<strong>知识库 + 问题跟踪</strong>，我用的是<strong>Confluence + Jira</strong>，工欲善其事必先利其器，我们先需要把工具选择和准备好，再开始后面的事情，下面介绍下Confluence的安装流程</p>
<h1 id="为什么是Confluence"><a href="#为什么是Confluence" class="headerlink" title="为什么是Confluence"></a>为什么是Confluence</h1><ul>
<li>丰富的知识库相关的模板</li>
<li>在线协作编辑</li>
<li>每个人的知识可以分享给全公司的人</li>
<li>评论功能和提醒功能完美结合，随时随地得到最新知识库更新</li>
<li>和JIRA结合完美</li>
</ul>
<h1 id="工具包准备"><a href="#工具包准备" class="headerlink" title="工具包准备"></a>工具包准备</h1><ul>
<li>  <a target="_blank" rel="noopener" href="https://www.atlassian.com/software/confluence/downloads/binary/atlassian-confluence-6.9.0.tar.gz">atlassian-confluence-6.9.0 官方下载地址</a></li>
</ul>
<h1 id="安装和启动"><a href="#安装和启动" class="headerlink" title="安装和启动"></a>安装和启动</h1><p>这里介绍2种安装和启动方式</p>
<ul>
<li>传统安装启动方式</li>
<li>Docker安装启动方式（推荐）</li>
</ul>
<h2 id="传统安装和启动"><a href="#传统安装和启动" class="headerlink" title="传统安装和启动"></a>传统安装和启动</h2><p>需要准备</p>
<ul>
<li>CentOS 7.x</li>
<li>JDK 1.8（配置好JAVA_HOME）</li>
<li>MYSQL 5.7.X（二进制安装或者Docker镜像）</li>
</ul>
<p><strong>一顿操作猛如虎。。。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## 解压安装包</span><br><span class="line">cd your-path</span><br><span class="line">tar -xvf atlassian-confluence-6.9.0.tar.gz</span><br><span class="line">## 指定工作目录</span><br><span class="line">vi /your-path/atlassian-confluence-6.9.0/confluence/WEB-INF/classes/confluence-init.properties</span><br><span class="line"># 在文件中加入 confluence.home=/your-home-path/</span><br><span class="line">## mysql的驱动Jar去官网下载一个适合5.7的即可</span><br><span class="line">cp mysql-connector-java-5.1.45.jar /your-path/atlassian-confluence-6.9.0/confluence/WEB-INF/lib</span><br><span class="line">## 启动</span><br><span class="line">/your-path/atlassian-confluence-6.9.0/bin/start-confluence.sh</span><br><span class="line"># 默认是8090端口，在浏览器打开http://localhost:8090</span><br></pre></td></tr></table></figure>
<h2 id="Docker安装启动方式"><a href="#Docker安装启动方式" class="headerlink" title="Docker安装启动方式"></a>Docker安装启动方式</h2><p>需要准备</p>
<ul>
<li>Docker</li>
</ul>
<p>由于官方已经有镜像，我们在官方镜像上面加入自定义的内容即可，<a target="_blank" rel="noopener" href="https://github.com/cptactionhank/docker-atlassian-confluence/tree/6.9.0">官方的6.9.0的Dockerfile的Repo地址</a>，我们需要的是红框的2个文件，如下：<br><img src="/images/2020-02/confluence-docker-1.png"><br>我在本地Mac上面建立了一个Docker Build目录，包含下面几个文件</p>
<ul>
<li>Dockerfile（上面的官方repo下载）</li>
<li>atlassian-confluence-6.9.0.tar.gz（官方二进制包，主要是Dockerfile里面的Curl自动下载的速度实在是慢的可以，我在提前下载好，COPY进去，这块不是非必须用这个包，可以依赖Dockerfile的Curl到官方下载安装包）</li>
<li>docker-entrypoint.sh（上面的官方repo下载）<br>修改Dockerfile<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8-alpine</span><br><span class="line"></span><br><span class="line"># Setup useful environment variables</span><br><span class="line">ENV CONF_HOME     /var/atlassian/confluence</span><br><span class="line">ENV CONF_INSTALL  /opt/atlassian/confluence</span><br><span class="line">ENV CONF_VERSION  6.9.0</span><br><span class="line"></span><br><span class="line">ENV JAVA_CACERTS  $JAVA_HOME/jre/lib/security/cacerts</span><br><span class="line">ENV CERTIFICATE   $CONF_HOME/certificate</span><br><span class="line"></span><br><span class="line"># [新增] 把build目录的必要文件复制到镜像内</span><br><span class="line">COPY atlassian-confluence-$&#123;CONF_VERSION&#125;.tar.gz /tmp/atlassian-confluence-$&#123;CONF_VERSION&#125;.tar.gz</span><br><span class="line"></span><br><span class="line"># [新增] 创建Install目录，解压安装包，替换工具Jar包，删除安装包压缩文件</span><br><span class="line">RUN mkdir -p $&#123;CONF_INSTALL&#125;</span><br><span class="line">RUN tar -xzvf /tmp/atlassian-confluence-$&#123;CONF_VERSION&#125;.tar.gz -C $&#123;CONF_INSTALL&#125; --strip-components=1 --no-same-owner \</span><br><span class="line">    &amp;&amp; rm -rf /tmp/atlassian-confluence-$&#123;CONF_VERSION&#125;.tar.gz</span><br><span class="line"></span><br><span class="line"># Install Atlassian Confluence and helper tools and setup initial home</span><br><span class="line"># directory structure.</span><br><span class="line">RUN set -x \</span><br><span class="line">    &amp;&amp; apk --no-cache add curl xmlstarlet bash ttf-dejavu libc6-compat gcompat \</span><br><span class="line">    &amp;&amp; mkdir -p                &quot;$&#123;CONF_HOME&#125;&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;CONF_HOME&#125;&quot; \</span><br><span class="line">    &amp;&amp; chown daemon:daemon     &quot;$&#123;CONF_HOME&#125;&quot; \</span><br><span class="line">    &amp;&amp; mkdir -p                &quot;$&#123;CONF_INSTALL&#125;/conf&quot; \</span><br><span class="line">    &amp;&amp; curl -Ls                &quot;https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.44.tar.gz&quot; | tar -xz --directory &quot;$&#123;CONF_INSTALL&#125;/confluence/WEB-INF/lib&quot; --strip-components=1 --no-same-owner &quot;mysql-connector-java-5.1.44/mysql-connector-java-5.1.44-bin.jar&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;CONF_INSTALL&#125;/conf&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;CONF_INSTALL&#125;/temp&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;CONF_INSTALL&#125;/logs&quot; \</span><br><span class="line">    &amp;&amp; chmod -R 700            &quot;$&#123;CONF_INSTALL&#125;/work&quot; \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  &quot;$&#123;CONF_INSTALL&#125;/conf&quot; \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  &quot;$&#123;CONF_INSTALL&#125;/temp&quot; \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  &quot;$&#123;CONF_INSTALL&#125;/logs&quot; \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  &quot;$&#123;CONF_INSTALL&#125;/work&quot; \</span><br><span class="line">    &amp;&amp; echo -e                 &quot;\nconfluence.home=$CONF_HOME&quot; &gt;&gt; &quot;$&#123;CONF_INSTALL&#125;/confluence/WEB-INF/classes/confluence-init.properties&quot; \</span><br><span class="line">    &amp;&amp; xmlstarlet              ed --inplace \</span><br><span class="line">        --delete               &quot;Server/@debug&quot; \</span><br><span class="line">        --delete               &quot;Server/Service/Connector/@debug&quot; \</span><br><span class="line">        --delete               &quot;Server/Service/Connector/@useURIValidationHack&quot; \</span><br><span class="line">        --delete               &quot;Server/Service/Connector/@minProcessors&quot; \</span><br><span class="line">        --delete               &quot;Server/Service/Connector/@maxProcessors&quot; \</span><br><span class="line">        --delete               &quot;Server/Service/Engine/@debug&quot; \</span><br><span class="line">        --delete               &quot;Server/Service/Engine/Host/@debug&quot; \</span><br><span class="line">        --delete               &quot;Server/Service/Engine/Host/Context/@debug&quot; \</span><br><span class="line">                               &quot;$&#123;CONF_INSTALL&#125;/conf/server.xml&quot; \</span><br><span class="line">    &amp;&amp; touch -d &quot;@0&quot;           &quot;$&#123;CONF_INSTALL&#125;/conf/server.xml&quot; \</span><br><span class="line">    &amp;&amp; chown daemon:daemon     &quot;$&#123;JAVA_CACERTS&#125;&quot;</span><br><span class="line"></span><br><span class="line"># Use the default unprivileged account. This could be considered bad practice</span><br><span class="line"># on systems where multiple processes end up being executed by &#x27;daemon&#x27; but</span><br><span class="line"># here we only ever run one process anyway.</span><br><span class="line">USER daemon:daemon</span><br><span class="line"></span><br><span class="line"># Expose default HTTP connector port.</span><br><span class="line">EXPOSE 8090 8091</span><br><span class="line"></span><br><span class="line"># Set volume mount points for installation and home directory. Changes to the</span><br><span class="line"># home directory needs to be persisted as well as parts of the installation</span><br><span class="line"># directory due to eg. logs.</span><br><span class="line">VOLUME [&quot;/var/atlassian/confluence&quot;, &quot;/opt/atlassian/confluence/logs&quot;]</span><br><span class="line"></span><br><span class="line"># Set the default working directory as the Confluence home directory.</span><br><span class="line">WORKDIR /var/atlassian/confluence</span><br><span class="line"></span><br><span class="line">COPY docker-entrypoint.sh /</span><br><span class="line">ENTRYPOINT [&quot;/docker-entrypoint.sh&quot;]</span><br><span class="line"></span><br><span class="line"># Run Atlassian Confluence as a foreground process by default.</span><br><span class="line">CMD [&quot;/opt/atlassian/confluence/bin/start-confluence.sh&quot;, &quot;-fg&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
执行build<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /your-docker-build-path</span><br><span class="line">docker build -t michael/atlassian-confluence:6.9.0 .</span><br></pre></td></tr></table></figure>
启动镜像（配套如果使用MYSQL，建议Docker Compose启动Confluence + MYSQL）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --rm --name=wiki -p 8090:8090 -p 8091:8091 \</span><br><span class="line">-v /your-confluence-path/home:/var/atlassian/confluence \</span><br><span class="line">-v /your-confluence-path/logs:/opt/atlassian/confluence/logs \</span><br><span class="line">michael/atlassian-confluence:6.9.0 </span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/02/10/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E4%BA%8C%EF%BC%89%20%E2%80%94%E2%80%94%20Docker%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/10/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E4%BA%8C%EF%BC%89%20%E2%80%94%E2%80%94%20Docker%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">创业公司基础设施如何搭建（二） —— Docker安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-10 10:35:26" itemprop="dateCreated datePublished" datetime="2020-02-10T10:35:26+08:00">2020-02-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CentOS-7-x-Docker-CE"><a href="#CentOS-7-x-Docker-CE" class="headerlink" title="CentOS 7.x / Docker CE"></a>CentOS 7.x / Docker CE</h1><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"># repo建议使用阿里云的，官方的docker，国内连接起来不稳定</span><br><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">yum clean all # 清理yum</span><br><span class="line">yum makecache fast # 生成yum repo缓存</span><br><span class="line">yum install docker-ce # 安装docker社区版本</span><br><span class="line">systemctl enable docker # 设置为开机启动</span><br><span class="line">systemctl start docker # 启动docker服务</span><br></pre></td></tr></table></figure>
<h2 id="设置镜像加速器"><a href="#设置镜像加速器" class="headerlink" title="设置镜像加速器"></a>设置镜像加速器</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/multi-user.target.wants/docker.service</span><br><span class="line"># registry-mirror用的是阿里云的Hub加速器，可以在https://dev.aliyun.com/search.html申请自己的专属加速器地址</span><br><span class="line"># 找到ExecStart=这行，添加 --registry-mirror=https://xxxx.mirror.aliyuncs.com #使用阿里云加速</span><br><span class="line">ExecStart=/usr/bin/dockerd --registry-mirror=https://xxxx.mirror.aliyuncs.com</span><br></pre></td></tr></table></figure>
<h2 id="配置docker私服地址（可选）"><a href="#配置docker私服地址（可选）" class="headerlink" title="配置docker私服地址（可选）"></a>配置docker私服地址（可选）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/multi-user.target.wants/docker.service</span><br><span class="line"># 找到ExecStart=这行，添加 --insecure-registry=hub.xxx.com</span><br><span class="line">ExecStart=/usr/bin/dockerd --registry-mirror=https://xxxx.mirror.aliyuncs.com --insecure-registry=hub.xxx.com</span><br></pre></td></tr></table></figure>
<h2 id="自定义docker存储目录（可选）"><a href="#自定义docker存储目录（可选）" class="headerlink" title="自定义docker存储目录（可选）"></a>自定义docker存储目录（可选）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/multi-user.target.wants/docker.service</span><br><span class="line"># 找到ExecStart=这行，添加  --graph /opt1/docker</span><br><span class="line">ExecStart=/usr/bin/dockerd --registry-mirror=https://xxxx.mirror.aliyuncs.com --insecure-registry=hub.xxx.com  --graph /opt1/docker</span><br></pre></td></tr></table></figure>
<h2 id="重启Docker"><a href="#重启Docker" class="headerlink" title="重启Docker"></a>重启Docker</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload # 重新加载daemon</span><br><span class="line">systemctl restart docker # 重启docker</span><br></pre></td></tr></table></figure>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.docker.com/">Docker官网</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.aliyun.com/search.html">阿里云Docker Hub</a></li>
<li><a target="_blank" rel="noopener" href="https://hub.docker.com/">官方Docker Hub</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://skywalkerai.com/2020/02/09/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E4%B8%80%EF%BC%89%20%E2%80%94%E2%80%94%20%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="天行者YANG">
      <meta itemprop="description" content="技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天行者YANG - BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/09/%E5%88%9B%E4%B8%9A%E5%85%AC%E5%8F%B8%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%EF%BC%88%E4%B8%80%EF%BC%89%20%E2%80%94%E2%80%94%20%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87/" class="post-title-link" itemprop="url">创业公司基础设施如何搭建（一） —— 前期准备</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-09 10:55:02" itemprop="dateCreated datePublished" datetime="2020-02-09T10:55:02+08:00">2020-02-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="面临的问题"><a href="#面临的问题" class="headerlink" title="面临的问题"></a>面临的问题</h1><h2 id="创业公司一般面临下面几个问题"><a href="#创业公司一般面临下面几个问题" class="headerlink" title="创业公司一般面临下面几个问题"></a>创业公司一般面临下面几个问题</h2><ul>
<li>钱不多，省着花</li>
<li>一般研发人员，不具备此类知识体系或者所知不多</li>
</ul>
<h2 id="需求一直存在"><a href="#需求一直存在" class="headerlink" title="需求一直存在"></a>需求一直存在</h2><p>虽然，存在一些问题，但是随着业务发展，人员增多，此类问题会暴露的越发明显，产品技术团队的高效工作，其实是建立在合适、安全、方便的基础设施之上的</p>
<h1 id="如何解决"><a href="#如何解决" class="headerlink" title="如何解决"></a>如何解决</h1><h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><ul>
<li>Dell服务器1台（约2 - 3w RMB）</li>
<li>NAS存储，主要做重要系统数据备份（可选）</li>
<li>交换机（不做过多介绍）</li>
<li>整理办公和研发需求</li>
</ul>
<p>下面是选择的服务器，这个配置，基本可以满足100人左右企业的日常办公和部分研发测试需求</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>T640 塔式服务器</th>
</tr>
</thead>
<tbody><tr>
<td>CPU</td>
<td>Intel(R) Xeon(R) CPU 银牌4110*2</td>
</tr>
<tr>
<td>MEM</td>
<td>16G*6</td>
</tr>
<tr>
<td>硬盘</td>
<td>4T*3 raid5 + 256固态系统盘</td>
</tr>
</tbody></table>
<h2 id="基础设施包含什么"><a href="#基础设施包含什么" class="headerlink" title="基础设施包含什么"></a>基础设施包含什么</h2><ul>
<li>虚拟化的平台工具：我这里选择的是Vmware，好处毋庸置疑，但是收费，我这里之所以选，是因为，有一些历史原因（你懂得，有需求可以单独找我），如果不用，可以考虑OpenStack替代</li>
<li>容器化：Docker是不二之选，这个根据企业自己的需求来看，我个人觉得，初期可以不用容器化，但是，如果有相关维护人员，可以选择Docker Swam或者K8s进行容器化管理</li>
<li>根据需要选择工具：一般企业需要解决的是，知识库、项目和流程管理系统、资产管理系统、统一账户体系、代码库、工件库、如何在外安全上网、内部域名管理、如何安全登录服务器这些需求、数据安全和备份</li>
</ul>
<h1 id="基础设施搭建示意图"><a href="#基础设施搭建示意图" class="headerlink" title="基础设施搭建示意图"></a>基础设施搭建示意图</h1><p>基于VMware ESXI &amp; vSphere</p>
<h2 id="层级示意"><a href="#层级示意" class="headerlink" title="层级示意"></a>层级示意</h2><p><img src="/images/2020-02/ops-arch.jpg"></p>
<h2 id="架构示意"><a href="#架构示意" class="headerlink" title="架构示意"></a>架构示意</h2><p><img src="/images/2020-02/ops-layer.jpg"></p>
<h1 id="我用到的工具"><a href="#我用到的工具" class="headerlink" title="我用到的工具"></a>我用到的工具</h1><p><img src="/images/2020-02/arch-layer.jpg"></p>
<p>后续，会陆续介绍下，我在搭建的时候，相关工具的搭建流程和使用方式</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <img src="/images/wechat_qrcode.jpg" itemprop="contentUrl">
    <span>微信关注我，及时接收最新技术文章</span>
  </div>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="天行者YANG"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">天行者YANG</p>
  <div class="site-description" itemprop="description">技术团队管理者、10年以上互联网行业老兵，学会从本质出发的思考方式，希望通过写作，更好思考技术人生、分享一只老鸟的经验。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/ffbe5419f359" title="简书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;ffbe5419f359" rel="noopener" target="_blank"><i class="fas fa-book-open fa-fw"></i>简书</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://toutiao.io/subjects/199751" title="开发者头条 → https:&#x2F;&#x2F;toutiao.io&#x2F;subjects&#x2F;199751" rel="noopener" target="_blank"><i class="fas fa-book-open fa-fw"></i>开发者头条</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:michaelliu99@sina.com" title="E-Mail → mailto:michaelliu99@sina.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">天行者YANG</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
